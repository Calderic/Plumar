---
import { getCollection, render } from 'astro:content';
import ThemePageRenderer from '../../components/ThemePageRenderer.astro';
import { getPlumarConfig } from '../../utils/config.js';

const config = getPlumarConfig();

// é™æ€è·¯å¾„ç”Ÿæˆ - çº¯é€»è¾‘
export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map((post) => ({
    params: { slug: post.id },
    props: { post },
  }));
}

// æ•°æ®å¤„ç†é€»è¾‘
const { post } = Astro.props;
const { Content } = await render(post);

// é¡µé¢æ•°æ® - çº¯é€»è¾‘
const pageData = {
  title: `${post.data.title} - ${config.title}`,
  description: post.data.description || `${config.title} - ${post.data.title}`,
  pageType: 'post',
  post: post.data,
  Content: Content
};
---

<ThemePageRenderer {...pageData}>
  <!-- æ–‡ç« å†…å®¹ï¼šå½“ä¸»é¢˜æ²¡æœ‰è‡ªå®šä¹‰æ–‡ç« æ¨¡æ¿æ—¶æ˜¾ç¤º -->
  <article class="post-content">
    <header class="post-header">
      <h1>{post.data.title}</h1>
      <div class="post-meta">
        <time>ğŸ“… {post.data.date.toLocaleDateString('zh-CN')}</time>
        {post.data.tags.length > 0 && (
          <div class="post-tags">
            <span>ğŸ·ï¸ {post.data.tags.join(', ')}</span>
          </div>
        )}
        {post.data.categories.length > 0 && (
          <div class="post-categories">
            <span>ğŸ“‚ {post.data.categories.join(', ')}</span>
          </div>
        )}
      </div>
      {post.data.description && (
        <p class="post-description">{post.data.description}</p>
      )}
    </header>
    
    <div class="post-body">
      <Content />
    </div>
  </article>
  
  <nav class="post-nav">
    <a href="/blog">â† è¿”å›åšå®¢åˆ—è¡¨</a>
    <span>|</span>
    <a href="/">è¿”å›é¦–é¡µ</a>
  </nav>
</ThemePageRenderer> 