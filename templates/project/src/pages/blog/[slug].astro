---
import { getCollection, render } from 'astro:content';
import ThemePageRenderer from '../../components/ThemePageRenderer.astro';
import { getPlumarConfig } from '../../utils/config.js';

const config = getPlumarConfig();

// 静态路径生成 - 纯逻辑
export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map((post) => ({
    params: { slug: post.id },
    props: { post },
  }));
}

// 数据处理逻辑
const { post } = Astro.props;
const { Content } = await render(post);

// 页面数据 - 纯逻辑
const pageData = {
  title: `${post.data.title} - ${config.title}`,
  description: post.data.description || `${config.title} - ${post.data.title}`,
  pageType: 'post',
  post: post.data,
  Content: Content
};
---

<ThemePageRenderer {...pageData}>
  <!-- 文章内容：当主题没有自定义文章模板时显示 -->
  <article class="post-content">
    <header class="post-header">
      <h1>{post.data.title}</h1>
      <div class="post-meta">
        <time>📅 {post.data.date.toLocaleDateString('zh-CN')}</time>
        {post.data.tags.length > 0 && (
          <div class="post-tags">
            <span>🏷️ {post.data.tags.join(', ')}</span>
          </div>
        )}
        {post.data.categories.length > 0 && (
          <div class="post-categories">
            <span>📂 {post.data.categories.join(', ')}</span>
          </div>
        )}
      </div>
      {post.data.description && (
        <p class="post-description">{post.data.description}</p>
      )}
    </header>
    
    <div class="post-body">
      <Content />
    </div>
  </article>
  
  <nav class="post-nav">
    <a href="/blog">← 返回博客列表</a>
    <span>|</span>
    <a href="/">返回首页</a>
  </nav>
</ThemePageRenderer> 