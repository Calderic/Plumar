---
import { getCollection } from 'astro:content';
import ThemePageRenderer from '../../components/ThemePageRenderer.astro';
import { getPlumarConfig } from '../../utils/config.js';

const config = getPlumarConfig();

// æ•°æ®è·å–é€»è¾‘
const posts = await getCollection('blog', ({ data }) => {
  return data.draft !== true;
});

posts.sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime());

// é¡µé¢æ•°æ® - çº¯é€»è¾‘
const pageData = {
  title: `åšå®¢æ–‡ç«  - ${config.title}`,
  description: `${config.title}çš„åšå®¢æ–‡ç« åˆ—è¡¨`,
  pageType: 'blog',
  posts: posts
};
---

<ThemePageRenderer {...pageData}>
  <!-- åšå®¢åˆ—è¡¨å†…å®¹ï¼šå½“ä¸»é¢˜æ²¡æœ‰è‡ªå®šä¹‰åšå®¢åˆ—è¡¨æ—¶æ˜¾ç¤º -->
  <section class="blog-header">
    <h1>ğŸ“ åšå®¢æ–‡ç« </h1>
    <p>å…± {posts.length} ç¯‡æ–‡ç« </p>
  </section>
  
  <section class="posts-list">
    {posts.length === 0 ? (
      <div class="empty-state">
        <p>ğŸ“­ è¿˜æ²¡æœ‰æ–‡ç« ï¼Œä½¿ç”¨ <code>plumar new "æ–‡ç« æ ‡é¢˜"</code> åˆ›å»ºç¬¬ä¸€ç¯‡æ–‡ç« ã€‚</p>
      </div>
    ) : (
      posts.map((post) => (
        <article class="post-preview">
          <h2>
            <a href={`/blog/${post.id}`}>{post.data.title}</a>
          </h2>
          <div class="post-meta">
            <time>ğŸ“… {post.data.date.toLocaleDateString('zh-CN')}</time>
            {post.data.tags.length > 0 && (
              <div class="post-tags">
                <span>ğŸ·ï¸ {post.data.tags.join(', ')}</span>
              </div>
            )}
          </div>
          {post.data.description && (
            <p class="post-description">{post.data.description}</p>
          )}
        </article>
      ))
    )}
  </section>
  
  <nav class="page-nav">
    <a href="/">â† è¿”å›é¦–é¡µ</a>
  </nav>
</ThemePageRenderer> 